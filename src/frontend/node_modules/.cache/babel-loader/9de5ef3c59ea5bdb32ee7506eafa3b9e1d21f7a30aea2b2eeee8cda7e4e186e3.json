{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-3b7f3cf9\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"container py-5\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"spinner\"\n};\nconst _hoisted_3 = {\n  key: 1\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"alert alert-warning\"\n};\nconst _hoisted_5 = {\n  class: \"row row-cols-1 row-cols-md-3 g-4 py-5\"\n};\nconst _hoisted_6 = {\n  class: \"card\"\n};\nconst _hoisted_7 = {\n  class: \"card-img\"\n};\nconst _hoisted_8 = [\"src\"];\nconst _hoisted_9 = {\n  class: \"card-body\"\n};\nconst _hoisted_10 = {\n  class: \"card-title\"\n};\nconst _hoisted_11 = {\n  class: \"card-text\"\n};\nconst _hoisted_12 = {\n  class: \"mb-5 justify-content-around\"\n};\nconst _hoisted_13 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"lni lni-pencil\"\n}, null, -1 /* HOISTED */));\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \"Loading...\")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [$setup.books.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \"No recommendations available. \" + _toDisplayString($setup.err), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_5, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.books, item => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      class: \"col\",\n      key: item._id\n    }, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"img\", {\n      src: item.picture_link || $setup.defaultImage,\n      class: \"card-img-top\",\n      alt: \"Book image\"\n    }, null, 8 /* PROPS */, _hoisted_8)]), _createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"h5\", _hoisted_10, _toDisplayString(item.title), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_11, _toDisplayString(item.description), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"div\", null, [_createElementVNode(\"h4\", null, [_hoisted_13, _createTextVNode(_toDisplayString(item.author), 1 /* TEXT */)])])])])]);\n  }), 128 /* KEYED_FRAGMENT */))])]))]);\n}","map":{"version":3,"names":["class","key","_createElementVNode","_createElementBlock","_hoisted_1","$setup","loading","_hoisted_2","_hoisted_3","books","length","_hoisted_4","_toDisplayString","err","_createCommentVNode","_hoisted_5","_Fragment","_renderList","item","_id","_hoisted_6","_hoisted_7","src","picture_link","defaultImage","alt","_hoisted_8","_hoisted_9","_hoisted_10","title","_hoisted_11","description","_hoisted_12","_hoisted_13","_createTextVNode","author"],"sources":["C:\\Users\\mynig\\VScodium\\NWD-Books-Recommender\\src\\frontend\\src\\views\\RecomendedBooksView.vue"],"sourcesContent":["<template>\r\n    <div class=\"container py-5\" >\r\n        <div v-if=\"loading\" class=\"spinner\">Loading...</div>\r\n        <div v-else>\r\n            <div v-if=\"books.length === 0\" class=\"alert alert-warning\">No recommendations available. {{ err }}</div>\r\n            <div class=\"row row-cols-1 row-cols-md-3 g-4 py-5\">\r\n                <div class=\"col\" v-for=\"item in books\" :key=\"item._id\">\r\n                    <div class=\"card\">\r\n                        <div class=\"card-img\">\r\n                            <img :src=\"item.picture_link || defaultImage\" class=\"card-img-top\" alt=\"Book image\">\r\n                        </div>\r\n                        <div class=\"card-body\">\r\n                            <h5 class=\"card-title\">{{ item.title }}</h5>\r\n                            <p class=\"card-text\">{{ item.description }}</p>\r\n                        </div>\r\n                        <div class=\"mb-5 justify-content-around\">\r\n                            <div>\r\n                                <h4><i class=\"lni lni-pencil\"></i>{{ item.author }}</h4>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { computed, onMounted, ref } from 'vue';\r\nimport services from '../../services/services.js';\r\nimport { useStore } from 'vuex';\r\nimport env from '../../../env.js'\r\n\r\nexport default {\r\n    setup() {\r\n        const store = useStore();\r\n        const books = ref([]);\r\n        const loading = ref(true);\r\n        const user = computed(() => store.state.user);\r\n        const defaultImage = 'https://media.istockphoto.com/vectors/no-image-available-sign-vector-id1138179183?k=6&m=1138179183&s=612x612&w=0&h=prMYPP9mLRNpTp3XIykjeJJ8oCZRhb2iez6vKs8a8eE=';\r\n        const err = ref(null);\r\n\r\n        const fetchBookImages = async () => {\r\n            for (const book of books.value) {\r\n                const googleBooksUrl = `https://www.googleapis.com/books/v1/volumes?q=intitle:${encodeURIComponent(book.title)}+inauthor:${encodeURIComponent(book.author)}&key=${env.googleApiKey}`;\r\n                try {\r\n                    const res = await fetch(googleBooksUrl);\r\n                    const googleData = await res.json();\r\n\r\n                    if (googleData.items && Array.isArray(googleData.items)) {\r\n                        let itemWithImage = null;\r\n                        for (const item of googleData.items) {\r\n                            if (item.volumeInfo.imageLinks && item.volumeInfo.imageLinks.thumbnail) {\r\n                                itemWithImage = item;\r\n                                break;\r\n                            }\r\n                        }\r\n\r\n                        if (itemWithImage) {\r\n                            book.picture_link = itemWithImage.volumeInfo.imageLinks.thumbnail;\r\n                        } else {\r\n                            book.picture_link = defaultImage;\r\n                        }\r\n                    } else {\r\n                        console.warn('Unexpected Google Books API response format:', googleData);\r\n                        book.picture_link = defaultImage;\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Error fetching book image:', error);\r\n                    book.picture_link = defaultImage;\r\n                }\r\n            }\r\n        };\r\n\r\n        const getRecommendations = async () => {\r\n            loading.value = true;\r\n\r\n            try {\r\n                const bmks = await services.getBookmarks(1, 15, user.value._id);\r\n                const lkG = await services.getGenres(user.value._id);\r\n                \r\n                const bmk = bmks.data.books.map(book => `${book.title} - ${book.author}`);\r\n                const genres = lkG.data.genres;\r\n\r\n                if ( bmk.length == 0){\r\n                    err.value = 'No books bookmarked! Pleas do so.'\r\n                }\r\n                else{\r\n                    const response = await services.getRecomended({\r\n                        bookmarks: bmk,\r\n                        likedGenres: genres\r\n                    });\r\n                    const data = response.data;\r\n                    books.value = data.recommendedBooks;\r\n\r\n                    setTimeout(() => {\r\n                        fetchBookImages();\r\n                    }, 0);\r\n                }\r\n\r\n            } catch (error) {\r\n                console.error('Error fetching books:', error.response.data.msg);\r\n                err.value = error.response.data.msg;\r\n            } finally {\r\n                loading.value = false;\r\n            }\r\n        };\r\n\r\n        onMounted(() => {\r\n            getRecommendations();\r\n        });\r\n\r\n        return {\r\n            books,\r\n            loading,\r\n            defaultImage,\r\n            err\r\n        };\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  * {\r\n    padding: 0;\r\n    margin: 0;\r\n    box-sizing: border-box;\r\n  }\r\n  .card-img-top {\r\n    border-radius: 50px;\r\n    height: 300px;\r\n    width: 300px; \r\n    padding: 20px;\r\n  }\r\n  .card-img {\r\n    align-items: center;\r\n  }\r\n  .card {\r\n    border-radius: 30px;\r\n    box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px;\r\n    background-color: rgb(255, 255, 255, 0.8);\r\n  }\r\n  .card-text {\r\n    max-height: 200px;  \r\n  }\r\n  .card-body {\r\n    padding: 25px;\r\n    margin-top: -15px;\r\n  }\r\n</style>\r\n"],"mappings":";;;EACSA,KAAK,EAAC;AAAgB;;EAD/BC,GAAA;EAE4BD,KAAK,EAAC;;;EAFlCC,GAAA;AAAA;;EAAAA,GAAA;EAI2CD,KAAK,EAAC;;;EAChCA,KAAK,EAAC;AAAuC;;EAErCA,KAAK,EAAC;AAAM;;EACRA,KAAK,EAAC;AAAU;mBAR7C;;EAW6BA,KAAK,EAAC;AAAW;;EACdA,KAAK,EAAC;AAAY;;EACnBA,KAAK,EAAC;AAAW;;EAEnBA,KAAK,EAAC;AAA6B;iEAE5BE,mBAAA,CAA8B;EAA3BF,KAAK,EAAC;AAAgB;;uBAhBzDG,mBAAA,CAuBM,OAvBNC,UAuBM,GAtBSC,MAAA,CAAAC,OAAO,I,cAAlBH,mBAAA,CAAoD,OAApDI,UAAoD,EAAhB,YAAU,M,cAC9CJ,mBAAA,CAoBM,OAvBdK,UAAA,GAIuBH,MAAA,CAAAI,KAAK,CAACC,MAAM,U,cAAvBP,mBAAA,CAAwG,OAAxGQ,UAAwG,EAA7C,gCAA8B,GAAAC,gBAAA,CAAGP,MAAA,CAAAQ,GAAG,oBAJ3GC,mBAAA,gBAKYZ,mBAAA,CAiBM,OAjBNa,UAiBM,I,kBAhBFZ,mBAAA,CAeMa,SAAA,QArBtBC,WAAA,CAMgDZ,MAAA,CAAAI,KAAK,EAAbS,IAAI;yBAA5Bf,mBAAA,CAeM;MAfDH,KAAK,EAAC,KAAK;MAAwBC,GAAG,EAAEiB,IAAI,CAACC;QAC9CjB,mBAAA,CAaM,OAbNkB,UAaM,GAZFlB,mBAAA,CAEM,OAFNmB,UAEM,GADFnB,mBAAA,CAAoF;MAA9EoB,GAAG,EAAEJ,IAAI,CAACK,YAAY,IAAIlB,MAAA,CAAAmB,YAAY;MAAExB,KAAK,EAAC,cAAc;MAACyB,GAAG,EAAC;4BATnGC,UAAA,E,GAWwBxB,mBAAA,CAGM,OAHNyB,UAGM,GAFFzB,mBAAA,CAA4C,MAA5C0B,WAA4C,EAAAhB,gBAAA,CAAlBM,IAAI,CAACW,KAAK,kBACpC3B,mBAAA,CAA+C,KAA/C4B,WAA+C,EAAAlB,gBAAA,CAAvBM,IAAI,CAACa,WAAW,iB,GAE5C7B,mBAAA,CAIM,OAJN8B,WAIM,GAHF9B,mBAAA,CAEM,cADFA,mBAAA,CAAwD,aAApD+B,WAA8B,EAjBlEC,gBAAA,CAAAtB,gBAAA,CAiBqEM,IAAI,CAACiB,MAAM,iB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}